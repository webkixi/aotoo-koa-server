{"version":3,"sources":["fkpcore/router/control.js"],"names":["Control","ctx","oridata","routerIns","get","undefined","post","data","opts","store","initStat","prototype","init","options","dft","GET","POST","_","isPlainObject","extend","e","console","log","run","mtd","method","_data","_get","_post","isFunction","call","set","name","put","PUT","delete","DELETE","myControl","route","odata","controlConfigs","merge","_put","_delete","control","_id","Cache","ifid","instance"],"mappings":"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","file":"../../../fkpcore/router/control.js","sourcesContent":["\"use strict\";\n\nfunction Control(ctx, oridata, routerIns){\n  this.ctx = ctx || null\n  this.get = undefined\n  this.post = undefined\n  this.data = oridata\n  this.opts = {}\n  this.store = {}\n  this.initStat = false\n  this.routerIns = routerIns\n}\n\nControl.prototype = {\n  init: function(options){\n    try {\n      var dft = {\n        get: this.get,\n        post: this.post,\n        GET: this.get,\n        POST: this.post\n      }\n      if (_.isPlainObject(options)) dft = _.extend(dft, options)\n      this.initStat = true\n      this.opts = dft\n\n    } catch (e) {\n      console.log(e);\n    }\n  },\n  run: function(ctx, options){\n    try {\n      const routerIns = this.routerIns\n      this.ctx = ctx\n      if (!this.initStat) if (_.isPlainObject(options)) this.init(options)\n      let opts = this.opts\n      let mtd = ctx.method\n      let _data = this.data\n\n      const _get = opts.get || opts.GET\n      const _post = opts.post || opts.POST\n\n      if (mtd === 'GET' && _.isFunction(_get)) {\n        _data = _get.call(routerIns, ctx)\n      }\n\n      if (mtd === 'POST' && _.isFunction(_post)){\n        _data = _post.call(routerIns, ctx)\n      }\n      return _data\n    } catch (e) {\n      console.log(e);\n    }\n  },\n  set: function(name, data){\n    if (!name || !data) return\n    this.store[name] = data\n  }\n}\n\nconst dft = {\n  get: '',\n  GET: '',\n\n  post: '',\n  POST: '',\n\n  put: '',\n  PUT: '',\n\n  delete: '',\n  DELETE: ''\n}\n\nfunction myControl(route, ctx, odata, routerIns, options) {\n  var controlConfigs = _.merge({}, dft, options)\n  const _get = controlConfigs.get || controlConfigs.GET\n  const _post = controlConfigs.post || controlConfigs.POST\n  const _put = controlConfigs.put || controlConfigs.PUT\n  const _delete = controlConfigs.delete || controlConfigs.DELETE\n\n  switch (ctx.method) {\n    case 'GET':\n      if (_.isFunction(_get)) {\n        return _get.call(routerIns, ctx)\n      }\n      break;\n\n    case 'POST':\n      if (_.isFunction(_post)) {\n        return _post.call(routerIns, ctx)\n      }\n      break;\n\n    case 'PUT':\n      if (_.isFunction(_put)) {\n        return _put.call(routerIns, ctx)\n      }\n      break;\n\n    case 'DELETE':\n      if (_.isFunction(_delete)) {\n        return _delete.call(routerIns, ctx)\n      }\n      break;\n  }\n}\n\nfunction control(route, ctx, odata, routerIns){\n  // return new Control(ctx, odata, routerIns)\n  let _id = route+'_controler'\n  return Cache.ifid(_id, function(){\n    let instance = new Control(ctx, odata, routerIns)\n    Cache.set(_id, instance)\n    return instance\n  })\n}\n\nexport default myControl\n"]}