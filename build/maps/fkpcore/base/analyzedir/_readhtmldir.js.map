{"version":3,"sources":["fkpcore/base/analyzedir/_readhtmldir.js"],"names":["analyzeDir","chkType","type","indexOf","replace","all","style","templet","script","staticType","item","arys","_","getTempTitle","content","title","match","exec","getMdTitle","cnt","trim","substring","fileStat","collection","dirs","root","tmp","docsConfig","analyzeDirMehtod","directory","htmlDir","readdirSync","parent","map","filename","ii","subItem","itemState","statSync","ext","profile","isFile","readFileSync","url","attr","_url","fileName","fullpath","des","ctime","birthtime","getMdUrl","_path","descript","stat","push","isDirectory","cn_filename","idf","configPath","existsSync","_config","require"],"mappings":"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","file":"../../../../fkpcore/base/analyzedir/_readhtmldir.js","sourcesContent":["import fs from 'fs'\nimport {parse, extname, join as $join} from 'path'\n\n\n// const _data = [\n//   {title: '典型页面', content: '123', idf: 'aaa'},\n//   {title: '典型页面1', content: 'aaa', idf: 'bbb', parent: 'aaa'},\n//   {title: '典型页面2', content: 'bbb', parent: 'aaa', attr: {\"href\":'http://www.163.com'}},\n//   {title: '典型页面3', content: 'ccc', parent: 'aaa'},\n//   {title: '典型页面4', content: 'ddd', parent: 'bbb'},\n//   {title: '典型页面5', content: 'eee', parent: 'bbb'},\n//   {title: '导航', content: '111'},\n//   {title: '表单', content: '333'},\n//   {title: '列表', content: '444'},\n//   {title: '高级搜索', content: '5555'}\n// ]\n\nfunction chkType(type) {\n  if (type.indexOf('.')===0) type = type.replace('.', '')\n  var all = {\n    style: ['css', 'less', 'stylus', 'styl'],\n    templet: ['hbs', 'ejs', 'jade', 'pug', 'htm', 'html', 'php', 'jsp'],\n    script: ['js', 'jsx', 'coffee', 'cjsx', 'ts', 'tsx']\n  }\n  let  staticType = 'script'\n  for (var item in all) {\n    var arys = all[item];\n    if (_.indexOf(arys, type) > -1) staticType = item;\n  }\n  return staticType\n}\n\n\nfunction getTempTitle(content) {\n  let title = content.match(/<title>([\\s\\S]*?)<\\/title>/ig)\n  if (title && title[0].indexOf(\"{{title}}\")>-1 ) {\n    title = [/<meta name=\"subtitle\" content=(.*?)\\/>/.exec(content)[1].replace(/[\"|']/g, '')]\n  }\n  return title\n}\n\nfunction getMdTitle(cnt) {\n  let title = cnt.match(/#([\\s\\S]*?)\\n/)||''\n  if (title) title = _.trim(title[1].replace(/ \\{(.*)\\}/g, ''))  // 清除自定义属性，如{\"id\":\"xxx\"}\n  if (title.indexOf('@')==0) {\n    title = title.substring(1)\n    fileStat = 'recommend'\n  }\n  return title\n}\n\n\nlet collection = []\nlet dirs = { root: '' }\nlet tmp = {}\nlet docsConfig\nfunction analyzeDirMehtod(directory){\n  let htmlDir = fs.readdirSync( directory )\n  const parent = directory == dirs.root ? '' : directory\n  // const parent = directory\n  htmlDir.map(function(filename, ii){\n    const subItem = $join(directory, filename)\n    const itemState = fs.statSync(subItem)\n    const ext = extname(filename)\n    let profile = {}\n    if (itemState.isFile() && filename.indexOf('_') !=0 && filename.indexOf('.') !=0 ) {\n      if (chkType(ext) == 'templet') {\n        let content = fs.readFileSync(subItem, 'utf8')\n        let title = getTempTitle(content)\n        if(title && title[0]){\n          profile ={\n            title: title[0].replace(/\\<(\\/?)title\\>/g,'').replace(/ \\{(.*)\\}/g, ''),\n            url: parent + '/' + filename,\n            attr: {\"href\": _url},\n            content: '',\n            parent: parent,\n            fileName: filename.replace(ext,'.html'),\n            fullpath: subItem,\n            des: '',\n            ctime: itemState.ctime,\n            birthtime: itemState.birthtime\n          }\n\n          // html同名的md说明文件\n          // .....\n        }\n      }\n\n      if (ext == '.md') {\n        function getMdUrl(){\n          const root = dirs.root.indexOf('/') > -1 ? dirs.root.substring(0, dirs.root.indexOf('/')) : _path\n          return '/docs'+subItem.replace(root, '').replace('.md', '')\n        }\n\n        let content = fs.readFileSync(subItem, 'utf8')\n        let descript = 'getDescript(content)'\n        let title = getMdTitle(content)\n        let _url = getMdUrl()\n        if(directory && subItem.indexOf(directory) == -1) filename = filename.replace(ext,'_md.html')\n\n        if (title) {\n          profile = {\n            title: title,\n            url: _url,\n            attr: {\"href\": _url},\n            content: '',\n            parent: parent,\n            stat: '',    // 文件title在列表中的状态，如推荐，热门等等，通过title的头字符描述\n            fileName: filename,\n            fullpath: subItem,\n            des: descript,\n            ctime: itemState.ctime,\n            birthtime: itemState.birthtime\n          }\n        }\n        collection.push(profile)\n      }\n    }\n\n    if (itemState.isDirectory() && filename.indexOf('_') !=0 && filename.indexOf('.') !=0 ) {\n      let cn_filename\n      if (docsConfig) {\n        if (docsConfig.directory[filename]) {\n          cn_filename = docsConfig.directory[filename]\n        }\n      }\n      profile = {\n        title: cn_filename || filename,\n        content: '',\n        idf: subItem,\n        parent: parent\n      }\n      collection.push(profile)\n      analyzeDirMehtod(subItem)\n    }\n  })\n}\n\nexport function analyzeDir(_path){\n  if (!_path) return false\n  collection = []\n  dirs.root = _path\n  _path = _path.indexOf('/') == 0 ? _path.substring(1) : _path\n  let configPath = _path + '/config.js'\n  if (fs.existsSync(configPath)) {\n    const _config = require(configPath)\n    docsConfig = _config\n  }\n\n  analyzeDirMehtod(_path)\n  return collection\n}\n"]}