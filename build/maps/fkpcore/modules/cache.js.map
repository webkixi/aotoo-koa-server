{"version":3,"sources":["fkpcore/modules/cache.js"],"names":["md5","require","LRU","options","max","length","n","key","dispose","value","maxAge","Configs","Aotoo","merge","cache","cac","has","_","isString","get","set","peek","del","ifid","id","callback","reset","forEach","rforEach","keys","values","itemCount","dump","load","prune","module","exports"],"mappings":";;AAAA;;;AAGA,IAAIA,MAAMC,QAAQ,aAAR,CAAV;AACA,IAAIC,MAAMD,QAAQ,WAAR,CAAV;AAAA,IACCE,UAAU,EAAEC,KAAK,GAAP;AACLC,SAAQ,gBAAUC,CAAV,EAAaC,GAAb,EAAkB;AAAE,SAAOD,IAAI,CAAJ,GAAQC,IAAIF,MAAnB;AAA2B,EADlD;AAELG,UAAS,iBAAUD,GAAV,EAAeE,KAAf,EAAsB,CAAI,CAF9B;AAGNC,SAAQ,KAAK,EAAL,GAAU,EAAV,GAAe,IAHjB,EADX;;AAMC,IAAI,OAAOC,OAAP,IAAkB,WAAtB,EAAmC;AAClCR,WAAUS,MAAMC,KAAN,CAAYV,OAAZ,EAAqBQ,QAAQG,KAA7B,CAAV;AACA;AACD,IAAIA,QAAQZ,IAAIC,OAAJ,CAAZ;;AAED,IAAIY,MAAM;AACTC,MAAK,aAAST,GAAT,EAAa;AACjB,MAAIU,EAAEC,QAAF,CAAWX,GAAX,CAAJ,EAAoB;AACnBA,SAAMP,IAAIO,GAAJ,CAAN;AACA;AACD,SAAOO,MAAME,GAAN,CAAUT,GAAV,CAAP;AACA,EANQ;AAOTY,MAAK,aAASZ,GAAT,EAAa;AACjB,MAAIU,EAAEC,QAAF,CAAWX,GAAX,CAAJ,EAAoB;AACnBA,SAAMP,IAAIO,GAAJ,CAAN;AACA;AACD,SAAOO,MAAMK,GAAN,CAAUZ,GAAV,CAAP;AACA,EAZQ;AAaTa,MAAK,aAASb,GAAT,EAAcE,KAAd,EAAqBC,MAArB,EAA4B;AAChC,MAAIO,EAAEC,QAAF,CAAWX,GAAX,CAAJ,EAAoB;AACnBA,SAAMP,IAAIO,GAAJ,CAAN;AACA;AACD,SAAOO,MAAMM,GAAN,CAAUb,GAAV,EAAeE,KAAf,EAAsBC,MAAtB,CAAP;AACA,EAlBQ;AAmBTW,OAAM,cAASd,GAAT,EAAa;AAClB,MAAIU,EAAEC,QAAF,CAAWX,GAAX,CAAJ,EAAoB;AACnBA,SAAMP,IAAIO,GAAJ,CAAN;AACA;AACD,SAAOO,MAAMO,IAAN,CAAWd,GAAX,CAAP;AACA,EAxBQ;AAyBTe,MAAK,aAASf,GAAT,EAAa;AACjB,MAAIU,EAAEC,QAAF,CAAWX,GAAX,CAAJ,EAAoB;AACnBA,SAAMP,IAAIO,GAAJ,CAAN;AACA;AACD,SAAOO,MAAMQ,GAAN,CAAUf,GAAV,CAAP;AACA,EA9BQ;AA+BTgB,OAAM,cAACC,EAAD,EAAKC,QAAL,EAAkB;AACvB,MAAIV,IAAIC,GAAJ,CAAQQ,EAAR,CAAJ,EAAgB;AACf,UAAOT,IAAII,GAAJ,CAAQK,EAAR,CAAP;AACA,GAFD,MAGK;AACJ,OAAI,OAAOC,QAAP,KAAoB,UAAxB,EAAmC;AAClC,WAAOA,UAAP;AACA;AACD;AACD,EAxCQ;AAyCTC,QAAOZ,MAAMY,KAzCJ;AA0CTC,UAASb,MAAMa,OA1CN;AA2CTC,WAAUd,MAAMc,QA3CP;AA4CTC,OAAMf,MAAMe,IA5CH;AA6CTC,SAAQhB,MAAMgB,MA7CL;AA8CTzB,SAAQS,MAAMT,MA9CL;AA+CT0B,YAAWjB,MAAMiB,SA/CR;AAgDTC,OAAMlB,MAAMkB,IAhDH;AAiDTC,OAAMnB,MAAMmB,IAjDH;AAkDTC,QAAOpB,MAAMoB;AAlDJ,CAAV;;AAqDAC,OAAOC,OAAP,GAAiBrB,GAAjB","file":"../../../fkpcore/modules/cache.js","sourcesContent":["/*\n * lru cache\n*/\nvar md5 = require('blueimp-md5');\nvar LRU = require('lru-cache'),\n\toptions = { max: 300\n\t\t  , length: function (n, key) { return n * 2 + key.length }\n\t\t  , dispose: function (key, value) {  }\n\t\t\t, maxAge: 24 * 60 * 60 * 1000 };\n\t\n\tif (typeof Configs != 'undefined') {\n\t\toptions = Aotoo.merge(options, Configs.cache)\n\t}\n\tvar cache = LRU(options);\n\nvar cac = {\n\thas: function(key){\n\t\tif (_.isString(key)){\n\t\t\tkey = md5(key);\n\t\t}\n\t\treturn cache.has(key)\n\t},\n\tget: function(key){\n\t\tif (_.isString(key)){\n\t\t\tkey = md5(key);\n\t\t}\n\t\treturn cache.get(key)\n\t},\n\tset: function(key, value, maxAge){\n\t\tif (_.isString(key)){\n\t\t\tkey = md5(key);\n\t\t}\n\t\treturn cache.set(key, value, maxAge)\n\t},\n\tpeek: function(key){\n\t\tif (_.isString(key)){\n\t\t\tkey = md5(key);\n\t\t}\n\t\treturn cache.peek(key)\n\t},\n\tdel: function(key){\n\t\tif (_.isString(key)){\n\t\t\tkey = md5(key);\n\t\t}\n\t\treturn cache.del(key)\n\t},\n\tifid: (id, callback) => {\n\t\tif (cac.has(id)){\n\t\t\treturn cac.get(id)\n\t\t}\n\t\telse {\n\t\t\tif (typeof callback === 'function'){\n\t\t\t\treturn callback()\n\t\t\t}\n\t\t}\n\t},\n\treset: cache.reset,\n\tforEach: cache.forEach,\n\trforEach: cache.rforEach,\n\tkeys: cache.keys,\n\tvalues: cache.values,\n\tlength: cache.length,\n\titemCount: cache.itemCount,\n\tdump: cache.dump,\n\tload: cache.load,\n\tprune: cache.prune\n}\n\nmodule.exports = cac\n"]}